import{P as Q,r as v,aM as G,b as H,l as J,o as q,d as t,w as s,e as F,h as A,c as W,R as X,f as Y,j as Z,p as C,g as ee,aN as i,aO as ae,k as l,ax as le,ay as re,t as N,az as te,aP as oe,aQ as se,F as ne}from"./index-KC8Fu95-.js";import{u as ue,c as ie,b as d,a as de,d as me,e as u}from"./index.esm-CFF9iISF.js";import{r as I}from"./restaurant-DTXCIQ25.js";import{b as _}from"./route-block-B_A1xBdJ.js";import{V as pe,a as z}from"./VRow-Js2kYVxX.js";import{V as ve}from"./VDivider-CgzjqxB6.js";import{V as ce}from"./VDataTable-Di4asx99.js";import{V as ge}from"./VToolbar-Y2KqT72l.js";import{V as Ve}from"./VContainer-C62bWApN.js";import{V as fe}from"./VForm-Ci8mZxrG.js";import{a as ye}from"./VSelect-CxcFQ9up.js";import{V as be}from"./VTextarea-BJrplP7S.js";import{V as ke}from"./VSwitch-BTnxWqe0.js";import"./VPagination-FJlCxQ8A.js";import"./VChip-PMzwQLBL.js";import"./VList-DJyRj5q_.js";import"./ssrBoot-CCrmWCSd.js";import"./VMenu-B01AtdRN.js";const xe={class:"px-4"},we={class:"px-4"},Me={__name:"restaurants",setup(Ae){const p=Q(),D=v([]),S=v(""),O=[{title:"名稱",key:"name"},{title:"圖片",key:"image",sortable:!1},{title:"地址",key:"address"},{title:"電話",key:"phone"},{title:"分類",key:"category"},{title:"價格",key:"price"},{title:"描述",key:"description"},{title:"上架",key:"sell"},{title:"營養提醒",key:"nutritionInfo"},{title:"縣市",key:"city"},{title:"建立日期",key:"createdAt",value:r=>new Date(r.createdAt).toLocaleString()},{title:"更新日期",key:"updatedAt",value:r=>new Date(r.updatedAt).toLocaleString()},{title:"操作",key:"action",sortable:!1}],j=["_id","name","address","phone","category","price","description","nutritionInfo","createdAt","updatedAt"],T=async()=>{try{const{data:r}=await I.getAll();D.value=r.restaurants}catch(r){console.error("Error fetching restaurants:",r),p({text:"無法載入餐廳資料",snackbarProps:{color:"red"}})}};T();const h=G("fileAgent"),n=v({open:!1,id:""}),B=r=>{r&&(n.value.id=r._id,c.value.value=r.name,g.value.value=r.address,V.value.value=r.phone,f.value.value=r.price,y.value.value=r.category,b.value.value=r.description,k.value.value=r.sell,x.value.value=r.nutritionInfo,w.value.value=r.city),n.value.open=!0},P=()=>{n.value.open=!1,n.value.id="",L(),h.value.deleteFileRecord()},R=["台式","義式","美式","日式","韓式","蔬食","早餐","飲料","麵","飯","義大利麵","漢堡","拉麵","壽司"],{handleSubmit:E,resetForm:L,isSubmitting:U}=ue({validationSchema:ie({name:d().required("餐廳名稱是必填的").min(1,"餐廳名稱至少需要 1 個字").max(100,"餐廳名稱最多只能有 100 個字"),address:d().required("餐廳地址是必填的").min(1,"餐廳地址至少需要 1 個字").max(50,"餐廳地址最多只能有 50 個字"),phone:d().required("餐廳電話是必填的").min(9,"餐廳電話至少需要 9 個字").max(10,"餐廳電話最多只能有 10 個字"),price:me().min(0,"價格不能為負數"),category:d().required("分類是必填的").oneOf(R,"請選擇有效的分類"),description:d().max(500,"描述最多只能有 500 個字"),sell:de().required("是否上架是必填的"),nutritionInfo:d(),city:d().min(3,"縣市至少需要 3 個字")}),initialValues:{name:"",address:"",phone:"",price:0,category:"",description:"",sell:!0,nutritionInfo:"",city:""}}),c=u("name"),g=u("address"),V=u("phone"),f=u("price"),y=u("category"),b=u("description"),k=u("sell"),x=u("nutritionInfo"),w=u("city"),m=v([]),$=v([]),K=E(async r=>{var e,M,a;if((e=m.value[0])!=null&&e.error){p({text:"請選擇有效的檔案",snackbarProps:{color:"red"}});return}if(n.value.id.length===0&&m.value.length===0){p({text:"請上傳餐廳圖片",snackbarProps:{color:"red"}});return}try{const o=new FormData;o.append("name",r.name),o.append("address",r.address),o.append("phone",r.phone),o.append("price",r.price),o.append("category",r.category),o.append("description",r.description),o.append("sell",r.sell),o.append("nutritionInfo",r.nutritionInfo),o.append("city",r.city),m.value.length>0&&o.append("image",m.value[0].file),await(n.value.id.length===0?I.create(o):I.update(n.value.id,o)),p({text:"操作成功！",snackbarProps:{color:"green"}}),P(),T()}catch(o){console.error(o),p({text:((a=(M=o==null?void 0:o.response)==null?void 0:M.data)==null?void 0:a.message)||"操作失敗，請稍後再試",snackbarProps:{color:"red"}})}});return(r,e)=>{const M=H("VueFileAgent");return q(),J(ne,null,[t(Ve,null,{default:s(()=>[t(pe,null,{default:s(()=>[t(z,{cols:"12"},{default:s(()=>e[14]||(e[14]=[F("h1",{class:"text-center"},"餐廳管理",-1)])),_:1,__:[14]}),t(ve),t(z,{cols:"12"},{default:s(()=>[t(ce,{"filter-keys":j,headers:O,items:D.value,search:S.value},{top:s(()=>[t(ge,null,{default:s(()=>[F("div",xe,[t(A,{variant:"outlined",onClick:e[0]||(e[0]=a=>B(null))},{default:s(()=>e[15]||(e[15]=[C("新增餐廳")])),_:1,__:[15]})]),t(ee),F("div",we,[t(i,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=a=>S.value=a),clearable:"",density:"compact",flat:"","hide-details":"",placeholder:"搜尋餐廳","prepend-inner-icon":"mdi-magnify",variant:"solo",width:"400"},null,8,["modelValue"])])]),_:1})]),"item.image":s(({value:a})=>[t(Z,{src:a,width:"75"},null,8,["src"])]),"item.sell":s(({value:a})=>[a?(q(),W(Y,{key:0,icon:"mdi-check"})):X("",!0)]),"item.action":s(({item:a})=>[t(A,{icon:"mdi-pencil",variant:"text",onClick:o=>B(a)},null,8,["onClick"])]),_:2},1032,["items","search"])]),_:1})]),_:1})]),_:1}),t(se,{modelValue:n.value.open,"onUpdate:modelValue":e[13]||(e[13]=a=>n.value.open=a),persistent:"",width:"600"},{default:s(()=>[t(fe,{disabled:l(U),onSubmit:ae(l(K),["prevent"])},{default:s(()=>[t(le,null,{default:s(()=>[t(re,null,{default:s(()=>[C(N(n.value.id.length>0?"編輯餐廳":"新增餐廳"),1)]),_:1}),t(te,null,{default:s(()=>[t(i,{modelValue:l(c).value.value,"onUpdate:modelValue":e[2]||(e[2]=a=>l(c).value.value=a),"error-messages":l(c).errorMessage.value,label:"名稱"},null,8,["modelValue","error-messages"]),t(i,{modelValue:l(g).value.value,"onUpdate:modelValue":e[3]||(e[3]=a=>l(g).value.value=a),"error-messages":l(g).errorMessage.value,label:"地址"},null,8,["modelValue","error-messages"]),t(i,{modelValue:l(w).value.value,"onUpdate:modelValue":e[4]||(e[4]=a=>l(w).value.value=a),"error-messages":l(w).errorMessage.value,label:"縣市"},null,8,["modelValue","error-messages"]),t(i,{modelValue:l(V).value.value,"onUpdate:modelValue":e[5]||(e[5]=a=>l(V).value.value=a),"error-messages":l(V).errorMessage.value,label:"電話"},null,8,["modelValue","error-messages"]),t(i,{modelValue:l(f).value.value,"onUpdate:modelValue":e[6]||(e[6]=a=>l(f).value.value=a),modelModifiers:{number:!0},"error-messages":l(f).errorMessage.value,label:"價格"},null,8,["modelValue","error-messages"]),t(ye,{modelValue:l(y).value.value,"onUpdate:modelValue":e[7]||(e[7]=a=>l(y).value.value=a),"error-messages":l(y).errorMessage.value,items:R,label:"分類"},null,8,["modelValue","error-messages"]),t(i,{modelValue:l(x).value.value,"onUpdate:modelValue":e[8]||(e[8]=a=>l(x).value.value=a),"error-messages":l(x).errorMessage.value,label:"營養提醒"},null,8,["modelValue","error-messages"]),t(be,{modelValue:l(b).value.value,"onUpdate:modelValue":e[9]||(e[9]=a=>l(b).value.value=a),"error-messages":l(b).errorMessage.value,label:"描述"},null,8,["modelValue","error-messages"]),t(M,{ref_key:"fileAgent",ref:h,modelValue:m.value,"onUpdate:modelValue":e[10]||(e[10]=a=>m.value=a),"raw-model-value":$.value,"onUpdate:rawModelValue":e[11]||(e[11]=a=>$.value=a),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不正確",size:"檔案大小不得超過 1MB"},"help-text":"選擇或拖曳檔案","max-size":"1MB"},null,8,["modelValue","raw-model-value"]),t(ke,{modelValue:l(k).value.value,"onUpdate:modelValue":e[12]||(e[12]=a=>l(k).value.value=a),color:"success","error-messages":l(k).errorMessage.value,"hide-details":"",label:"上架"},null,8,["modelValue","error-messages"])]),_:1}),t(oe,null,{default:s(()=>[t(A,{color:"red",disabled:l(U),variant:"tonal",onClick:P},{default:s(()=>e[16]||(e[16]=[C("取消")])),_:1,__:[16]},8,["disabled"]),t(A,{color:"green",loading:l(U),type:"submit",variant:"tonal"},{default:s(()=>[C(N(n.value.id.length>0?"編輯":"新增"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof _=="function"&&_(Me);export{Me as default};
