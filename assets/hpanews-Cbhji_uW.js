import{aU as B,r as h,Q as S,Y as U,X as ne,aV as re,aW as oe,c as g,o as d,w as l,d as s,e as u,R as x,l as E,aN as ie,aX as ue,f as P,p as f,t as _,F as Y,n as F,aF as ce,N as de,ax as me,ay as ve,az as fe,aP as pe,aO as he,g as ge,h as X}from"./index-KC8Fu95-.js";import{b as j}from"./route-block-B_A1xBdJ.js";import{a as w,V as y}from"./VRow-Js2kYVxX.js";import{V as we}from"./VContainer-C62bWApN.js";import{V as N}from"./VDivider-CgzjqxB6.js";import{a as _e}from"./VSelect-CxcFQ9up.js";import{V as I}from"./VChip-PMzwQLBL.js";import{V as ye}from"./VAlert-Dwb1btdZ.js";import{V as Ve}from"./VPagination-FJlCxQ8A.js";import{V as xe}from"./VFooter-iXQR7Lf9.js";import"./VList-DJyRj5q_.js";import"./ssrBoot-CCrmWCSd.js";import"./VMenu-B01AtdRN.js";class Te{constructor(){this.cache=new Map,this.defaultTTL=2*24*60*60*1e3}set(o,n,i=this.defaultTTL){const v=Date.now();this.cache.set(o,{data:n,timestamp:v,ttl:i})}get(o){const n=this.cache.get(o);return n?Date.now()-n.timestamp>n.ttl?(this.cache.delete(o),null):n.data:null}has(o){const n=this.cache.get(o);return n?Date.now()-n.timestamp>n.ttl?(this.cache.delete(o),!1):!0:!1}delete(o){this.cache.delete(o)}clear(){this.cache.clear()}getStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}}const T=new Te,q={getAllThisYear(){return B.api.get("/hpanews")},searchThisYear(k){const o={};return k&&(o.keyword=k),B.api.get("/hpanews/search",{params:o})},getLatestThisYear(){return B.api.get("/hpanews/latest")}},ke={class:"text-body-2 text-grey-darken-1"},be={class:"mb-6"},Ce={class:"d-flex flex-wrap gap-3"},De=["innerHTML"],Se={class:"d-flex justify-space-between align-center mt-2"},Ee={key:4,class:"d-flex justify-center mt-10"},Ne={class:"d-flex ga-3"},R=12,Ae=Object.assign({name:"Hpanews"},{__name:"hpanews",setup(k){const o=["mdi-github","mdi-google","mdi-linkedin","mdi-instagram"],n=h([]),i=h(!1),v=h(""),c=h(""),H=h(null),b=h("全部"),p=h(1),C=h("newest"),G=[{title:"最新發布",value:"newest"},{title:"最舊發布",value:"oldest"},{title:"最近更新",value:"recently_updated"}],A=S(()=>{let a=[...n.value];if(c.value&&c.value.trim()!==""){const e=c.value.toLowerCase();a=a.filter(r=>{var t,m;return((t=r.標題)==null?void 0:t.toLowerCase().includes(e))||((m=r.內容)==null?void 0:m.toLowerCase().includes(e))})}switch(C.value){case"newest":return a.sort((e,r)=>{const t=new Date(e.發布日期||0);return new Date(r.發布日期||0)-t});case"oldest":return a.sort((e,r)=>{const t=new Date(e.發布日期||0),m=new Date(r.發布日期||0);return t-m});case"recently_updated":return a.sort((e,r)=>{const t=new Date(e.修改日期||e.發布日期||0);return new Date(r.修改日期||r.發布日期||0)-t});default:return a}}),W=S(()=>Math.ceil(A.value.length/R)),L=S(()=>{const a=(p.value-1)*R,e=a+R;return A.value.slice(a,e)}),Q=S(()=>A.value),D={LATEST_NEWS:"hpanews_latest",SEARCH_PREFIX:"hpanews_search_"},J=["全部","營養","健康","癌症","糖尿病","高血壓","膽固醇","肥胖","運動","飲食","兒童","戒菸","補助","檢查"],Z=a=>({全部:"mdi-newspaper-variant",營養:"mdi-food-apple",健康:"mdi-heart",癌症:"mdi-hospital",糖尿病:"mdi-spoon-sugar",高血壓:"mdi-heart-pulse",肥胖:"mdi-weight",運動:"mdi-run",飲食:"mdi-food-fork-drink",兒童:"mdi-baby-face",戒菸:"mdi-smoking-off",補助:"mdi-cash",檢查:"mdi-stethoscope"})[a]||"mdi-newspaper-variant",ee=()=>{p.value=1},$=async()=>{if(!(!c.value||c.value.trim()==="")){i.value=!0,v.value="";try{const a=`${D.SEARCH_PREFIX}${c.value}`,e=T.get(a);if(e){const V=new Set(n.value.map(z=>z.標題)),le=e.filter(z=>!V.has(z.標題));n.value=[...n.value,...le];return}const t=(await q.searchThisYear(c.value)).data.data||[],m=new Set(n.value.map(V=>V.標題)),se=t.filter(V=>!m.has(V.標題));n.value=[...n.value,...se],T.set(a,t)}catch(a){console.error("搜尋新聞失敗:",a),v.value="載入新聞時發生錯誤，請稍後再試"}finally{i.value=!1}}},te=async a=>{b.value=a,p.value=1,a==="全部"?(c.value="",H.value=null,await M()):(c.value=a,H.value=null,await $())},K=a=>{if(!a)return"";try{return new Date(a).toLocaleDateString("zh-TW")}catch{return a}},ae=(a,e)=>{if(!a)return"";const r=a.replace(/<[^>]*>/g,"");return r.length<=e?a:r.slice(0,Math.max(0,e))+"..."},O=a=>{a&&window.open(a,"_blank")},M=async()=>{i.value=!0,v.value="",p.value=1;try{const a=T.get(D.LATEST_NEWS);if(a){n.value=a,i.value=!1;return}const r=(await q.getLatestThisYear()).data.data||[];n.value=r,T.set(D.LATEST_NEWS,r)}catch(a){console.error("載入最新新聞失敗:",a),v.value="載入最新新聞時發生錯誤，請稍後再試",n.value=[]}finally{i.value=!1}};return U(C,()=>{p.value=1}),U(c,()=>{p.value=1}),ne(()=>{M()}),re(()=>{if(n.value.length===0){const a=T.get(D.LATEST_NEWS);a?n.value=a:M()}}),(a,e)=>{const r=oe("lazy");return d(),g(y,null,{default:l(()=>[s(w,{cols:"12"},{default:l(()=>[s(we,null,{default:l(()=>[s(y,null,{default:l(()=>[s(w,{cols:"12"},{default:l(()=>[e[11]||(e[11]=u("h1",{class:"mb-2"},"最新健康新聞",-1)),s(N,{class:"mb-5 border-opacity-50",color:"orange-darken-2",length:"150",thickness:5}),s(y,{class:"align-center mb-1"},{default:l(()=>[s(w,{class:"pa-2",cols:"12",md:"8"},{default:l(()=>[s(ie,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t),clearable:"","hide-details":"",label:"搜尋關鍵字",placeholder:"例如：營養、健康、癌症、兒童",variant:"outlined",onKeyup:ue($,["enter"])},null,8,["modelValue"])]),_:1}),s(w,{class:"pa-3",cols:"12",md:"2"},{default:l(()=>[s(_e,{modelValue:C.value,"onUpdate:modelValue":[e[1]||(e[1]=t=>C.value=t),ee],"hide-details":"",items:G,label:"排序方式",variant:"outlined"},{"prepend-inner":l(()=>[s(P,null,{default:l(()=>e[5]||(e[5]=[f("mdi-sort")])),_:1,__:[5]})]),_:1},8,["modelValue"])]),_:1}),s(w,{class:"pa-2",cols:"12",md:"2"},{default:l(()=>[u("span",ke," 共找到 "+_(Q.value.length)+" 篇新聞 ",1)]),_:1})]),_:1}),u("div",be,[u("div",Ce,[(d(),E(Y,null,F(J,t=>s(I,{key:t,class:"font-weight-medium transition-all hover-lift mt-2 mr-2",color:b.value===t?"primary":"default",loading:i.value&&b.value===t,size:"large",variant:b.value===t?"elevated":"outlined",onClick:m=>te(t)},{default:l(()=>[s(P,{class:"mr-2",icon:Z(t)},null,8,["icon"]),f(" "+_(t),1)]),_:2},1032,["color","loading","variant","onClick"])),64))])]),i.value?(d(),g(y,{key:0},{default:l(()=>[s(w,{class:"text-center",cols:"12"},{default:l(()=>[s(ce,{color:"primary",indeterminate:"",size:"64"}),e[6]||(e[6]=u("p",{class:"mt-4"},"正在載入健康新聞...",-1))]),_:1,__:[6]})]),_:1})):x("",!0),v.value?(d(),g(ye,{key:1,closable:"",type:"error","onClick:close":e[2]||(e[2]=t=>v.value="")},{default:l(()=>[f(_(v.value),1)]),_:1})):x("",!0),L.value.length>0?(d(),g(y,{key:2},{default:l(()=>[(d(!0),E(Y,null,F(L.value,t=>(d(),g(w,{key:t.標題,cols:"12",lg:"4",md:"6"},{default:l(()=>[de((d(),g(me,{class:"h-100 mb-3 cursor-pointer",elevation:"2",hover:"",onClick:m=>O(t.連結網址)},{default:l(()=>[s(ve,{class:"text-h6"},{default:l(()=>[f(_(t.標題),1)]),_:2},1024),s(fe,{class:"pb-2"},{default:l(()=>[u("div",{class:"text-body-2 text-truncate-3",style:{"line-height":"1.6","max-height":"120px",overflow:"hidden"},innerHTML:ae(t.內容,130)},null,8,De),u("div",Se,[s(I,{color:"info",size:"small",variant:"outlined"},{default:l(()=>[f(_(K(t.發布日期)),1)]),_:2},1024),t.修改日期&&t.修改日期!==t.發布日期?(d(),g(I,{key:0,color:"warning",size:"small",variant:"outlined"},{default:l(()=>[f(" 更新: "+_(K(t.修改日期)),1)]),_:2},1024)):x("",!0)])]),_:2},1024),s(pe,{onClick:e[3]||(e[3]=he(()=>{},["stop"]))},{default:l(()=>[s(ge),s(X,{class:"mt-3 mr-2",color:"primary",variant:"elevated",onClick:m=>O(t.連結網址)},{default:l(()=>e[7]||(e[7]=[f(" 閱讀更多 ")])),_:2,__:[7]},1032,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])),[[r]])]),_:2},1024))),128))]),_:1})):!i.value&&L.value.length===0?(d(),g(y,{key:3},{default:l(()=>[s(w,{class:"text-center",cols:"12"},{default:l(()=>[s(P,{color:"grey",size:"64"},{default:l(()=>e[8]||(e[8]=[f("mdi-newspaper-variant-outline")])),_:1,__:[8]}),e[9]||(e[9]=u("p",{class:"text-h6 mt-4"},"沒有找到相關的健康新聞",-1)),e[10]||(e[10]=u("p",{class:"text-body-2 text-grey"},"請嘗試其他關鍵字或日期範圍",-1))]),_:1,__:[9,10]})]),_:1})):x("",!0),W.value>1&&!i.value?(d(),E("div",Ee,[s(Ve,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=t=>p.value=t),length:W.value,rounded:"circle","show-first-last-page":"","total-visible":7},null,8,["modelValue","length"])])):x("",!0)]),_:1,__:[11]})]),_:1})]),_:1}),s(xe,{class:"text-center d-flex flex-column ga-2 mt-7",color:"indigo-lighten-1"},{default:l(()=>[u("div",Ne,[(d(),E(Y,null,F(o,t=>s(X,{key:t,density:"comfortable",icon:t,variant:"text"},null,8,["icon"])),64))]),s(N,{class:"my-2",thickness:"2",width:"50"}),e[13]||(e[13]=u("div",{class:"text-caption font-weight-regular opacity-60"}," Phasellus feugiat arcu sapien, et iaculis ipsum elementum sit amet. Mauris cursus commodo interdum. Praesent ut risus eget metus luctus accumsan id ultrices nunc. Sed at orci sed massa consectetur dignissim a sit amet dui. Duis commodo vitae velit et faucibus. Morbi vehicula lacinia malesuada. Nulla placerat augue vel ipsum ultrices, cursus iaculis dui sollicitudin. Vestibulum eu ipsum vel diam elementum tempor vel ut orci. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. ",-1)),s(N),u("div",null,[s(N,{class:"pt-5"}),f(" "+_(new Date().getFullYear())+" — ",1),e[12]||(e[12]=u("strong",null," © Yuna 版權所有",-1))])]),_:1,__:[13]})]),_:1})]),_:1})}}});typeof j=="function"&&j(Ae);export{Ae as default};
