import{q as G,s as H,a9 as J,aF as Q,aG as W,C as X,aH as Y,aI as q,d as a,m as N,aJ as Z,aK as ee,P as ae,r as k,aL as le,b as te,l as oe,o as z,w as r,e as B,h as M,c as re,R as se,f as ne,j as ue,p as S,g as ie,aM as I,aN as de,k as o,ax as ce,ay as me,t as E,az as pe,aO as ve,aP as Ve,F as fe}from"./index-BpE4l8E1.js";import{u as ge,c as be,a as ye,b as R,d as ke,e as x}from"./index.esm-DO3_2iYO.js";import{p as T}from"./product-DyodI6c0.js";import{b as L}from"./route-block-B_A1xBdJ.js";import{V as xe,a as O}from"./VRow-CssBu1oD.js";import{V as Ce}from"./VDivider-BcHjN56j.js";import{a as j,m as Ae,V as Fe,b as Pe}from"./VDataTable-BeN3rWZK.js";import{V as we}from"./VToolbar-BebnOMxj.js";import{V as he}from"./VContainer-Bp0PKZ_j.js";import{V as _e}from"./VForm-DRMmihyc.js";import{V as Me}from"./VTextarea-BXcsjvZA.js";import"./VPagination-CG2SNP2q.js";import"./VList-BgSJE9SD.js";import"./ssrBoot-DLccWrPe.js";import"./VMenu-Bc-rcDVZ.js";import"./VChip-DQVUrN2V.js";const Se=H({...ee(),...Z(Ae(),["inline"])},"VCheckbox"),De=G()({name:"VCheckbox",inheritAttrs:!1,props:Se(),emits:{"update:modelValue":u=>!0,"update:focused":u=>!0},setup(u,i){let{attrs:C,slots:d}=i;const c=J(u,"modelValue"),{isFocused:D,focus:A,blur:F}=Q(u),n=W();return X(()=>{const[P,w]=Y(C),h=q.filterProps(u),U=j.filterProps(u);return a(q,N({class:["v-checkbox",u.class]},P,h,{modelValue:c.value,"onUpdate:modelValue":b=>c.value=b,id:u.id||`checkbox-${n}`,focused:D.value,style:u.style}),{...d,default:b=>{let{id:y,messagesId:m,isDisabled:p,isReadonly:v,isValid:V}=b;return a(j,N(U,{id:y.value,"aria-describedby":m.value,disabled:p.value,readonly:v.value},w,{error:V.value===!1,modelValue:c.value,"onUpdate:modelValue":f=>c.value=f,onFocus:A,onBlur:F}),d)}})}),{}}}),Ue={class:"px-4"},Be={class:"px-4"},Ie={__name:"products",setup(u){const i=ae(),C=k([]),d=k(""),c=[{title:"ID",key:"_id"},{title:"圖片",key:"image",sortable:!1},{title:"名稱",key:"name"},{title:"分類",key:"category"},{title:"價格",key:"price"},{title:"描述",key:"description"},{title:"上架",key:"sell"},{title:"建立日期",key:"createdAt",value:t=>new Date(t.createdAt).toLocaleString()},{title:"更新日期",key:"updatedAt",value:t=>new Date(t.updatedAt).toLocaleString()},{title:"操作",key:"action",sortable:!1}],D=["_id","name","category","price","description","createdAt","updatedAt"],A=async()=>{try{const{data:t}=await T.getAll();C.value=t.products}catch(t){console.error("Error fetching products:",t),i({text:"無法載入餐廳資料",snackbarProps:{color:"red"}})}};A();const F=le("fileAgent"),n=k({open:!1,id:""}),P=t=>{t&&(n.value.id=t._id,m.value.value=t.name,p.value.value=t.price,v.value.value=t.category,V.value.value=t.description,f.value.value=t.sell),n.value.open=!0},w=()=>{n.value.open=!1,n.value.id="",b(),F.value.deleteFileRecord()},h=["電子產品","服裝","家居用品","書籍","玩具","食品","其他","麵","飯","夜市"],{handleSubmit:U,resetForm:b,isSubmitting:y}=ge({validationSchema:be({name:R().required("餐廳名稱是必填的").max(100,"餐廳名稱最多只能有 100 個字元"),price:ke().typeError("價格是必填的").required("價格是必填的").min(0,"價格不能為負數"),category:R().required("分類是必填的").oneOf(h,"請選擇有效的分類"),description:R().max(500,"描述最多只能有 500 個字元"),sell:ye().required("是否上架是必填的")}),initialValues:{name:"",price:0,category:"",description:"",sell:!1}}),m=x("name"),p=x("price"),v=x("category"),V=x("description"),f=x("sell"),g=k([]),$=k([]),K=U(async t=>{var e,_,l;if((e=g.value[0])!=null&&e.error){i({text:"請選擇有效的圖片檔案",snackbarProps:{color:"red"}});return}if(n.value.id.length===0&&g.value.length===0){i({text:"請上傳餐廳圖片",snackbarProps:{color:"red"}});return}try{const s=new FormData;s.append("name",t.name),s.append("price",t.price),s.append("category",t.category),s.append("description",t.description),s.append("sell",t.sell),g.value.length>0&&s.append("image",g.value[0].file),await(n.value.id.length===0?T.create(s):T.update(n.value.id,s)),i({text:"操作成功！",snackbarProps:{color:"green"}}),w(),A()}catch(s){console.error(s),i({text:((l=(_=s==null?void 0:s.response)==null?void 0:_.data)==null?void 0:l.message)||"操作失敗，請稍後再試",snackbarProps:{color:"red"}})}});return(t,e)=>{const _=te("VueFileAgent");return z(),oe(fe,null,[a(he,null,{default:r(()=>[a(xe,null,{default:r(()=>[a(O,{cols:"12"},{default:r(()=>e[10]||(e[10]=[B("h1",{class:"text-center"},"餐廳管理",-1)])),_:1,__:[10]}),a(Ce),a(O,{cols:"12"},{default:r(()=>[a(Fe,{"filter-keys":D,headers:c,items:C.value,search:d.value},{top:r(()=>[a(we,null,{default:r(()=>[B("div",Ue,[a(M,{variant:"outlined",onClick:e[0]||(e[0]=l=>P(null))},{default:r(()=>e[11]||(e[11]=[S("新增餐廳")])),_:1,__:[11]})]),a(ie),B("div",Be,[a(I,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=l=>d.value=l),density:"compact",flat:"","hide-details":"",placeholder:"搜尋餐廳","prepend-inner-icon":"mdi-magnify",variant:"solo",width:"400"},null,8,["modelValue"])])]),_:1})]),"item.image":r(({value:l})=>[a(ue,{src:l,width:"75"},null,8,["src"])]),"item.sell":r(({value:l})=>[l?(z(),re(ne,{key:0,icon:"mdi-check"})):se("",!0)]),"item.action":r(({item:l})=>[a(M,{icon:"mdi-pencil",variant:"text",onClick:s=>P(l)},null,8,["onClick"])]),_:2},1032,["items","search"])]),_:1})]),_:1})]),_:1}),a(Ve,{modelValue:n.value.open,"onUpdate:modelValue":e[9]||(e[9]=l=>n.value.open=l),persistent:"",width:"600"},{default:r(()=>[a(_e,{disabled:o(y),onSubmit:de(o(K),["prevent"])},{default:r(()=>[a(ce,null,{default:r(()=>[a(me,null,{default:r(()=>[S(E(n.value.id.length>0?"編輯餐廳":"新增餐廳"),1)]),_:1}),a(pe,null,{default:r(()=>[a(I,{modelValue:o(m).value.value,"onUpdate:modelValue":e[2]||(e[2]=l=>o(m).value.value=l),"error-messages":o(m).errorMessage.value,label:"名稱"},null,8,["modelValue","error-messages"]),a(I,{modelValue:o(p).value.value,"onUpdate:modelValue":e[3]||(e[3]=l=>o(p).value.value=l),modelModifiers:{number:!0},"error-messages":o(p).errorMessage.value,label:"價格",min:"0",type:"number"},null,8,["modelValue","error-messages"]),a(Pe,{modelValue:o(v).value.value,"onUpdate:modelValue":e[4]||(e[4]=l=>o(v).value.value=l),"error-messages":o(v).errorMessage.value,items:h,label:"分類"},null,8,["modelValue","error-messages"]),a(Me,{modelValue:o(V).value.value,"onUpdate:modelValue":e[5]||(e[5]=l=>o(V).value.value=l),"error-messages":o(V).errorMessage.value,label:"描述"},null,8,["modelValue","error-messages"]),a(_,{ref_key:"fileAgent",ref:F,modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=l=>g.value=l),"raw-model-value":$.value,"onUpdate:rawModelValue":e[7]||(e[7]=l=>$.value=l),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不正確",size:"檔案大小不得超過 1MB"},"help-text":"選擇或拖曳檔案","max-size":"1MB"},null,8,["modelValue","raw-model-value"]),a(De,{modelValue:o(f).value.value,"onUpdate:modelValue":e[8]||(e[8]=l=>o(f).value.value=l),"error-messages":o(f).errorMessage.value,"hide-details":"",label:"上架"},null,8,["modelValue","error-messages"])]),_:1}),a(ve,null,{default:r(()=>[a(M,{color:"red",disabled:o(y),onClick:w},{default:r(()=>e[12]||(e[12]=[S("取消")])),_:1,__:[12]},8,["disabled"]),a(M,{color:"green",loading:o(y),type:"submit"},{default:r(()=>[S(E(n.value.id.length>0?"編輯":"新增"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof L=="function"&&L(Ie);export{Ie as default};
