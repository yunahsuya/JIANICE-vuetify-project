import{q as Ze,s as et,a9 as tt,U as at,r as u,av as lt,ac as _e,Q as h,$ as st,ad as ot,a1 as it,C as nt,h as f,e as n,d as t,N as rt,O as ut,m as dt,M as mt,as as Me,at as ct,E as vt,J as pt,ai as gt,aK as ft,T as yt,u as bt,P as xt,X as he,Y as wt,b as Vt,c as v,o as i,w as s,R as g,l as b,aN as H,k as ae,p,aQ as le,aO as De,ax as O,ay as se,f as C,az as oe,aP as ie,g as ne,F as J,n as X,t as A,aF as kt,j as Se,aT as re}from"./index-KC8Fu95-.js";import{D as Ct,V as _t,a as ht}from"./DiaryCard-DqdLB70u.js";import{d as Q}from"./diary-D1b7W4TM.js";import{b as Ie}from"./route-block-B_A1xBdJ.js";import{V as Y,a as _}from"./VRow-Js2kYVxX.js";import{V as L}from"./VDivider-CgzjqxB6.js";import{a as pe}from"./VSelect-CxcFQ9up.js";import{V as Fe}from"./VForm-Ci8mZxrG.js";import{V as Pe}from"./VTextarea-BJrplP7S.js";import{V as ze}from"./VSwitch-BTnxWqe0.js";import{V as ue}from"./VChip-PMzwQLBL.js";import{V as Dt}from"./VPagination-FJlCxQ8A.js";import{V as St}from"./VContainer-C62bWApN.js";import"./ssrBoot-CCrmWCSd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VList-DJyRj5q_.js";import"./VMenu-B01AtdRN.js";const It=et({app:Boolean,appear:Boolean,extended:Boolean,layout:Boolean,offset:Boolean,modelValue:{type:Boolean,default:!0},...ft(yt({active:!0}),["location"]),...gt(),...pt(),...vt({transition:"fab-transition"})},"VFab"),Ft=Ze()({name:"VFab",props:It(),emits:{"update:modelValue":d=>!0},setup(d,R){let{slots:k}=R;const j=tt(d,"modelValue"),$=at(56),T=u(),{resizeRef:B}=lt(x=>{x.length&&($.value=x[0].target.clientHeight)}),I=_e(()=>d.app||d.absolute),F=h(()=>{var x;return I.value?((x=d.location)==null?void 0:x.split(" ").shift())??"bottom":!1}),de=h(()=>{var x;return I.value?((x=d.location)==null?void 0:x.split(" ")[1])??"end":!1});st(()=>d.app,()=>{const x=ot({id:d.name,order:h(()=>parseInt(d.order,10)),position:F,layoutSize:h(()=>d.layout?$.value+24:0),elementSize:h(()=>$.value+24),active:h(()=>d.app&&j.value),absolute:_e(()=>d.absolute)});it(()=>{T.value=x.layoutItemStyles.value})});const P=u();return nt(()=>{const x=f.filterProps(d);return n("div",{ref:P,class:ct(["v-fab",{"v-fab--absolute":d.absolute,"v-fab--app":!!d.app,"v-fab--extended":d.extended,"v-fab--offset":d.offset,[`v-fab--${F.value}`]:I.value,[`v-fab--${de.value}`]:I.value},d.class]),style:Me([d.app?{...T.value}:{height:d.absolute?"100%":"inherit"},d.style])},[n("div",{class:"v-fab__container"},[t(mt,{appear:d.appear,transition:d.transition},{default:()=>[rt(t(f,dt({ref:B},x,{active:void 0,location:void 0}),k),[[ut,d.active]])]})])])}),{}}}),Pt={class:"d-flex align-center"},zt={class:"d-flex align-center mb-3"},Mt={class:"d-flex align-center"},Ut={class:"mb-6"},$t={key:0,class:"text-center py-4"},Bt={key:1,class:"d-flex flex-wrap gap-2"},At={class:"text-body-1"},Lt={class:"mb-8"},Rt={class:"d-flex flex-wrap gap-3 align-center"},Tt={key:4,class:"d-flex justify-center mt-10"},Et={class:"d-flex align-center mr-3",style:{flex:"1","min-width":"0"}},Nt={key:0,class:"d-flex align-center gap-3"},Ot={class:"text-h5 text-primary-darken-1 font-weight-bold"},jt={key:1,class:"d-flex align-center gap-3",style:{flex:"1"}},Wt={class:"d-flex align-center gap-2 ml-4"},Ht={key:0},Qt={key:1,class:"mb-4"},Yt={key:0,class:"mb-4"},qt={class:"d-flex flex-wrap gap-2"},Jt={class:"d-flex align-center mb-3"},Xt={key:2,class:"mb-4"},Gt={key:3,class:"mb-4"},Kt={class:"text-body-1"},Zt={key:1,class:"text-body-1",style:{"white-space":"pre-wrap !important","word-wrap":"break-word !important","word-break":"break-all !important","overflow-wrap":"break-word !important","max-width":"100% !important","line-height":"1.6 !important",display:"block !important",width:"100% !important","box-sizing":"border-box !important"}},ea={key:4,class:"mt-4"},ta={class:"text-caption text-grey"},ge=12,aa={__name:"diary",setup(d){const R=bt(),k=xt(),j=u([]),$=u(!0),T=u(""),B=u("全部"),I=u(1),F=u("newest"),de=u(null),P=u([]),x=u([]),Ue=u(null),q=u([]),G=u([]),m=u({open:!1,diary:null}),w=u(!1),K=u(!1),r=u({title:"",description:"",category:"",date:"",sell:!0,existingImages:[]}),$e=h(()=>{const l=[...me.value];return l.push({title:"➕ 新增分類",value:"__add_new_category__",divider:!0}),l}),W=u([]),z=u({open:!1,submitting:!1}),M=u({name:""}),E=u({name:[]}),Be=h(()=>[...["全部","快樂","難過","生氣","平靜","問題","職訓局"],...W.value]),me=h(()=>[...["快樂","難過","生氣","平靜","問題","職訓局"],...W.value]),Ae=l=>{l==="__add_new_category__"&&(c.value.category="快樂",fe())},Z=async()=>{try{const{data:l}=await Q.getCustomCategories();W.value=l.categories||[]}catch(l){console.error("取得自定義分類失敗:",l)}},fe=()=>{M.value.name="",E.value.name=[],z.value.open=!0},ce=()=>{z.value.open=!1,z.value.submitting=!1},Le=()=>(E.value.name=[],M.value.name.trim()?M.value.name.trim().length>20?(E.value.name.push("分類名稱不能超過 20 個字元"),!1):["快樂","難過","生氣","平靜","問題","職訓局"].includes(M.value.name.trim())||W.value.includes(M.value.name.trim())?(E.value.name.push("此分類名稱已存在"),!1):!0:(E.value.name.push("請輸入分類名稱"),!1)),Re=async()=>{var l,e;if(Le()){z.value.submitting=!0;try{await Q.addCustomCategory(M.value.name.trim()),k({text:"分類新增成功！",snackbarProps:{color:"success"}}),ce(),await Z(),c.value.category=M.value.name.trim()}catch(o){console.error("新增分類失敗:",o),k({text:((e=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:e.message)||"新增失敗，請稍後再試",snackbarProps:{color:"error"}})}finally{z.value.submitting=!1}}};he(async()=>{await Promise.all([ee(),Z()])});const Te=[{title:"最新",value:"newest"},{title:"最舊",value:"oldest"}],ye=h(()=>{let l=j.value;if(B.value&&B.value!=="全部"&&(l=l.filter(e=>e.category===B.value)),T.value){const e=T.value.toLowerCase();l=l.filter(o=>o.description.toLowerCase().includes(e)||o.category.toLowerCase().includes(e))}return F.value&&(l=[...l].sort((e,o)=>{const a=new Date(e.date||e.createdAt),y=new Date(o.date||o.createdAt);return F.value==="newest"?y-a:F.value==="oldest"?a-y:0})),l}),Ee=l=>({全部:"mdi-book-heart",快樂:"mdi-emoticon-happy",難過:"mdi-emoticon-sad",生氣:"mdi-emoticon-angry",平靜:"mdi-emoticon-neutral",問題:"mdi-help-circle",職訓局:"mdi-school",今日目標:"mdi-target",開發紀錄:"mdi-code-braces",學習筆記:"mdi-notebook",工作心得:"mdi-briefcase",生活點滴:"mdi-heart",旅行回憶:"mdi-airplane",美食記錄:"mdi-food",運動健身:"mdi-dumbbell",閱讀心得:"mdi-book-open",音樂分享:"mdi-music",電影觀後感:"mdi-movie",寵物日常:"mdi-paw",家庭時光:"mdi-home-heart",朋友聚會:"mdi-account-group",健康管理:"mdi-heart-pulse",財務記錄:"mdi-wallet",創意發想:"mdi-lightbulb",感恩日記:"mdi-heart-multiple"})[l]||"mdi-tag",Ne=()=>{D.value={date:[],title:[],description:[],category:[],sell:[]};let l=!0;return c.value.title.length>50&&(D.value.title.push("標題最多只能有 50 字元"),l=!1),c.value.description.trim()?c.value.description.length>1e3&&(D.value.description.push("內容最多只能有 1000 字元"),l=!1):(D.value.description.push("請輸入回憶內容"),l=!1),me.value.includes(c.value.category)||(D.value.category.push("請選擇有效的分類"),l=!1),P.value.some(e=>e.error)&&(k({text:"請選擇有效的圖片檔案",snackbarProps:{color:"error"}}),l=!1),P.value.length===0&&(k({text:"請上傳回憶圖片",snackbarProps:{color:"error"}}),l=!1),l},Oe=l=>{B.value=l,I.value=1},be=h(()=>Math.ceil(ye.value.length/ge)),xe=h(()=>{const l=(I.value-1)*ge,e=l+ge;return ye.value.slice(l,e)}),ee=async()=>{try{$.value=!0;const{data:l}=await Q.get();j.value=l.diarys||[]}catch(l){console.error("載入日記失敗:",l)}finally{$.value=!1}},je=l=>{m.value.diary=l,m.value.open=!0,w.value=!1},We=()=>{m.value.open=!1,m.value.diary=null,w.value=!1},He=l=>{r.value.existingImages.splice(l,1)},Qe=async()=>{if(m.value.diary){te.value=!0;try{const l=m.value.diary;r.value={title:l.title||"",description:l.description||"",category:l.category||"快樂",date:l.date?Ye(l.date):"",sell:l.sell===void 0?!0:l.sell,existingImages:l.image?[...l.image]:[]},q.value=[],G.value=[],w.value=!0}catch(l){console.error("進入編輯模式失敗:",l),k({text:"進入編輯模式失敗，請稍後再試",snackbarProps:{color:"error"}})}finally{te.value=!1}}},we=()=>{w.value=!1,r.value={title:"",description:"",category:"",date:"",sell:!0,existingImages:[]},q.value=[],G.value=[]},Ve=async()=>{var l,e;if(m.value.diary){K.value=!0;try{const o=new FormData;o.append("title",r.value.title),o.append("description",r.value.description),o.append("category",r.value.category),o.append("date",r.value.date),o.append("sell",r.value.sell),r.value.existingImages&&r.value.existingImages.length>0&&o.append("existingImages",JSON.stringify(r.value.existingImages));const a=q.value.filter(V=>V.file);if(a.length>0)for(const V of a)o.append("image",V.file);if(await Q.update(m.value.diary._id,o),j.value.findIndex(V=>V._id===m.value.diary._id)!==-1){await ee();const V=j.value.find(N=>N._id===m.value.diary._id);V&&(m.value.diary=V)}k({text:"回憶更新成功",snackbarProps:{color:"success"}}),w.value=!1}catch(o){console.error("更新回憶失敗:",o),k({text:((e=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:e.message)||"更新失敗，請稍後再試",snackbarProps:{color:"error"}})}finally{K.value=!1}}},Ye=l=>{if(!l)return"";const e=new Date(l),o=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),y=String(e.getDate()).padStart(2,"0"),V=String(e.getHours()).padStart(2,"0"),N=String(e.getMinutes()).padStart(2,"0");return`${o}-${a}-${y}T${V}:${N}`},ke=l=>l?new Date(l).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"}):"",qe=l=>l?new Date(l).toLocaleString("zh-TW"):"";wt(F,()=>{I.value=1});const U=u({open:!1,submitting:!1}),c=u({date:"",title:"",description:`1. 
2. 
3. `,category:"快樂",sell:!0}),D=u({date:[],title:[],description:[],category:[],sell:[]}),Ce=()=>{const l=new Date,e=l.getFullYear(),o=String(l.getMonth()+1).padStart(2,"0"),a=String(l.getDate()).padStart(2,"0"),y=String(l.getHours()).padStart(2,"0"),V=String(l.getMinutes()).padStart(2,"0");c.value={date:`${e}-${o}-${a}T${y}:${V}`,title:"",description:`1. 
2. 
3. `,category:"快樂",sell:!0},D.value={date:[],title:[],description:[],category:[],sell:[]},P.value=[],x.value=[],U.value.open=!0},ve=()=>{U.value.open=!1,U.value.submitting=!1,P.value=[],x.value=[]},Je=async()=>{var l,e;if(Ne()){U.value.submitting=!0;try{const o=new FormData,a=new Date(c.value.date),y=new Date;a.setSeconds(y.getSeconds()),o.append("date",a.toISOString()),o.append("title",c.value.title),o.append("description",c.value.description),o.append("category",c.value.category),o.append("sell",c.value.sell);const V=P.value.filter(N=>N.file);if(V.length>0)for(const N of V)o.append("image",N.file);await Q.create(o),k({text:"回憶新增成功！",snackbarProps:{color:"success"}}),ve(),ee()}catch(o){console.error("新增回憶失敗:",o),k({text:((e=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:e.message)||"新增失敗，請稍後再試",snackbarProps:{color:"error"}})}finally{U.value.submitting=!1}}},te=u(!1),Xe=h(()=>!(!R.isLoggedIn||!m.value.diary)),S=u({open:!1,category:"",deleting:!1}),Ge=l=>{S.value.category=l,S.value.open=!0},Ke=async l=>{var e,o;try{S.value.deleting=!0,await Q.deleteCustomCategory(l),k({text:"分類刪除成功！",snackbarProps:{color:"success"}}),S.value.open=!1,await Z(),c.value.category===l&&(c.value.category="快樂"),r.value.category===l&&(r.value.category="快樂")}catch(a){console.error("刪除分類失敗:",a),k({text:((o=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:o.message)||"刪除失敗，請稍後再試",snackbarProps:{color:"error"}})}finally{S.value.deleting=!1}};return he(async()=>{await Promise.all([ee(),Z()])}),(l,e)=>{const o=Vt("VueFileAgent");return i(),v(St,null,{default:s(()=>[t(Y,null,{default:s(()=>[t(_,{cols:"12"},{default:s(()=>[e[25]||(e[25]=n("h1",{class:""},"回憶牆",-1)),t(L,{class:"border-opacity-50",color:"orange-darken-2",length:"100",thickness:5})]),_:1,__:[25]})]),_:1}),t(Y,{class:"mb-4"},{default:s(()=>[t(_,{cols:"12",lg:"8",md:"6"},{default:s(()=>[t(H,{modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=a=>T.value=a),clearable:"","hide-details":"",label:"搜尋回憶",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(_,{class:"d-flex align-center",cols:"12",lg:"2",md:"2"},{default:s(()=>[t(pe,{modelValue:F.value,"onUpdate:modelValue":e[1]||(e[1]=a=>F.value=a),clearable:"",density:"comfortable","hide-details":"",items:Te,label:"排序方式","prepend-inner-icon":"mdi-sort",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(_,{class:"d-flex align-center",cols:"12",lg:"2",md:"4"},{default:s(()=>[ae(R).isLoggedIn?(i(),v(f,{key:0,block:"",class:"text-none",color:"success",elevation:"2","prepend-icon":"mdi-plus",size:"large",onClick:Ce},{default:s(()=>e[26]||(e[26]=[p(" 新增回憶 ")])),_:1,__:[26]})):g("",!0)]),_:1})]),_:1}),t(le,{modelValue:U.value.open,"onUpdate:modelValue":e[9]||(e[9]=a=>U.value.open=a),"max-width":"800",persistent:""},{default:s(()=>[t(Fe,{onSubmit:De(Je,["prevent"])},{default:s(()=>[t(O,null,{default:s(()=>[t(se,{class:"d-flex align-center justify-space-between pa-6"},{default:s(()=>[n("div",Pt,[t(C,{class:"mr-3",color:"success",icon:"mdi-plus",size:"large"}),e[27]||(e[27]=n("span",{class:"text-h5 font-weight-medium"},"新增回憶",-1))]),t(f,{class:"text-none",icon:"mdi-close",variant:"text",onClick:ve})]),_:1}),t(L),t(oe,{class:"pa-6"},{default:s(()=>[t(Y,null,{default:s(()=>[t(_,{cols:"12",md:"6"},{default:s(()=>[t(H,{modelValue:c.value.date,"onUpdate:modelValue":e[2]||(e[2]=a=>c.value.date=a),density:"comfortable","error-messages":D.value.date,label:"日期和時間","prepend-inner-icon":"mdi-calendar-clock",type:"datetime-local",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),t(_,{cols:"12",md:"6"},{default:s(()=>[t(pe,{modelValue:c.value.category,"onUpdate:modelValue":[e[3]||(e[3]=a=>c.value.category=a),Ae],density:"comfortable","error-messages":D.value.category,items:$e.value,label:"分類","prepend-inner-icon":"mdi-tag",variant:"outlined"},null,8,["modelValue","error-messages","items"])]),_:1}),t(_,{cols:"12"},{default:s(()=>[t(H,{modelValue:c.value.title,"onUpdate:modelValue":e[4]||(e[4]=a=>c.value.title=a),density:"comfortable","error-messages":D.value.title,label:"回憶標題",placeholder:"為您的回憶取個標題...","prepend-inner-icon":"mdi-format-title",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),t(_,{cols:"12"},{default:s(()=>[t(Pe,{modelValue:c.value.description,"onUpdate:modelValue":e[5]||(e[5]=a=>c.value.description=a),"auto-grow":"",density:"comfortable","error-messages":D.value.description,label:"每日發生的三件好事",placeholder:"記錄今天發生的三件好事...","prepend-inner-icon":"mdi-text",rows:"4",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),t(_,{cols:"12"},{default:s(()=>[t(O,{class:"pa-4",variant:"outlined"},{default:s(()=>[n("div",zt,[t(C,{class:"mr-2",color:"success",icon:"mdi-image"}),e[28]||(e[28]=n("span",{class:"text-subtitle-1 font-weight-medium"},"回憶圖片",-1))]),t(o,{ref_key:"fileAgent",ref:de,modelValue:P.value,"onUpdate:modelValue":e[6]||(e[6]=a=>P.value=a),"raw-model-value":x.value,"onUpdate:rawModelValue":e[7]||(e[7]=a=>x.value=a),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不正確",size:"檔案大小不得超過 1MB"},"help-text":"選擇或拖曳圖片檔案到此處","max-files":5,"max-size":"1MB",multiple:"",theme:"grid","url-resolver":a=>a.url?a.url:a.data?a.data:a.preview?a.preview:null},null,8,["modelValue","raw-model-value","url-resolver"])]),_:1})]),_:1}),t(_,{cols:"12"},{default:s(()=>[t(O,{class:"pa-4",variant:"outlined"},{default:s(()=>[t(ze,{modelValue:c.value.sell,"onUpdate:modelValue":e[8]||(e[8]=a=>c.value.sell=a),class:"ma-0",color:"success","error-messages":D.value.sell,"hide-details":"",label:"公開分享到回憶牆"},{prepend:s(()=>[t(C,{class:"mr-2",color:"success",icon:"mdi-eye"})]),_:1},8,["modelValue","error-messages"]),e[29]||(e[29]=n("p",{class:"text-caption text-medium-emphasis mt-2 mb-0"}," 開啟後，可以在回憶牆上看到您的回憶 ",-1))]),_:1,__:[29]})]),_:1})]),_:1})]),_:1}),t(L),t(ie,{class:"pa-6"},{default:s(()=>[t(ne),t(f,{class:"text-none",color:"grey-darken-1",disabled:U.value.submitting,variant:"outlined",onClick:ve},{default:s(()=>e[30]||(e[30]=[p(" 關閉 ")])),_:1,__:[30]},8,["disabled"]),t(f,{class:"text-none",color:"success",loading:U.value.submitting,type:"submit",variant:"flat"},{default:s(()=>[t(C,{icon:"mdi-plus"}),e[31]||(e[31]=p(" 新增回憶 "))]),_:1,__:[31]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(le,{modelValue:z.value.open,"onUpdate:modelValue":e[11]||(e[11]=a=>z.value.open=a),"max-width":"600",persistent:""},{default:s(()=>[t(Fe,{onSubmit:De(Re,["prevent"])},{default:s(()=>[t(O,null,{default:s(()=>[t(se,{class:"d-flex align-center justify-space-between pa-6"},{default:s(()=>[n("div",Mt,[t(C,{class:"mr-3",color:"success",icon:"mdi-tag-plus",size:"large"}),e[32]||(e[32]=n("span",{class:"text-h5 font-weight-medium"},"分類管理",-1))]),t(f,{class:"text-none",icon:"mdi-close",variant:"text",onClick:ce})]),_:1}),t(L),t(oe,{class:"pa-6"},{default:s(()=>[n("div",Ut,[e[33]||(e[33]=n("h6",{class:"text-subtitle-1 font-weight-medium mb-3"},"新增自定義分類",-1)),t(H,{modelValue:M.value.name,"onUpdate:modelValue":e[10]||(e[10]=a=>M.value.name=a),density:"comfortable","error-messages":E.value.name,label:"分類名稱",placeholder:"例如：今日目標、開發紀錄...","prepend-inner-icon":"mdi-tag",variant:"outlined",maxlength:"20",counter:""},null,8,["modelValue","error-messages"]),e[34]||(e[34]=n("p",{class:"text-caption text-medium-emphasis"}," 分類名稱最多 20 個字元，新增後可以用來標記您的回憶 ",-1))]),t(L,{class:"my-4"}),n("div",null,[e[36]||(e[36]=n("h6",{class:"text-subtitle-1 font-weight-medium mb-3"},"管理自定義分類",-1)),W.value.length===0?(i(),b("div",$t,[t(C,{icon:"mdi-tag-off",size:"large",color:"grey"}),e[35]||(e[35]=n("p",{class:"text-body-2 text-medium-emphasis mt-2"},"目前沒有自定義分類",-1))])):(i(),b("div",Bt,[(i(!0),b(J,null,X(W.value,a=>(i(),v(ue,{key:a,class:"font-weight-medium",color:"primary",variant:"outlined",closable:"","onClick:close":y=>Ge(a)},{default:s(()=>[t(C,{class:"mr-2",icon:"mdi-tag"}),p(" "+A(a),1)]),_:2},1032,["onClick:close"]))),128))])),e[37]||(e[37]=n("p",{class:"text-caption text-medium-emphasis mt-3"}," 點擊分類標籤上的 X 按鈕可以刪除該分類 ",-1))])]),_:1}),t(L),t(ie,{class:"pa-6"},{default:s(()=>[t(ne),t(f,{class:"text-none",color:"grey-darken-1",disabled:z.value.submitting,variant:"outlined",onClick:ce},{default:s(()=>e[38]||(e[38]=[p(" 關閉 ")])),_:1,__:[38]},8,["disabled"]),t(f,{class:"text-none",color:"success",loading:z.value.submitting,type:"submit",variant:"flat"},{default:s(()=>[t(C,{icon:"mdi-plus"}),e[39]||(e[39]=p(" 分類管理 "))]),_:1,__:[39]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(le,{modelValue:S.value.open,"onUpdate:modelValue":e[14]||(e[14]=a=>S.value.open=a),"max-width":"400",persistent:""},{default:s(()=>[t(O,null,{default:s(()=>[t(se,{class:"d-flex align-center pa-6"},{default:s(()=>[t(C,{class:"mr-3",color:"warning",icon:"mdi-alert-circle",size:"large"}),e[40]||(e[40]=n("span",{class:"text-h6 font-weight-medium"},"確認刪除",-1))]),_:1,__:[40]}),t(oe,{class:"pa-6"},{default:s(()=>[n("p",At,[e[41]||(e[41]=p(" 確定要刪除分類「")),n("strong",null,A(S.value.category),1),e[42]||(e[42]=p("」嗎？ "))]),e[43]||(e[43]=n("p",{class:"text-caption text-medium-emphasis mt-2"}," 刪除後無法復原，請確認沒有日記使用此分類。 ",-1))]),_:1,__:[43]}),t(L),t(ie,{class:"pa-6"},{default:s(()=>[t(ne),t(f,{class:"text-none",color:"grey-darken-1",variant:"outlined",onClick:e[12]||(e[12]=a=>S.value.open=!1)},{default:s(()=>e[44]||(e[44]=[p(" 取消 ")])),_:1,__:[44]}),t(f,{class:"text-none",color:"error",variant:"flat",loading:S.value.deleting,onClick:e[13]||(e[13]=a=>Ke(S.value.category))},{default:s(()=>[t(C,{icon:"mdi-delete"}),e[45]||(e[45]=p(" 確定刪除 "))]),_:1,__:[45]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),ae(R).isLoggedIn?(i(),v(Ft,{key:0,app:"",color:"success",icon:"mdi-plus",location:"bottom end",size:"large",onClick:Ce})):g("",!0),n("div",Lt,[n("div",Rt,[(i(!0),b(J,null,X(Be.value,a=>(i(),v(ue,{key:a,class:"font-weight-medium transition-all hover-lift mr-2",color:B.value===a?"primary":"default",size:"large",variant:B.value===a?"elevated":"outlined",onClick:y=>Oe(a)},{default:s(()=>[t(C,{class:"mr-2",icon:Ee(a)},null,8,["icon"]),p(" "+A(a),1)]),_:2},1032,["color","variant","onClick"]))),128)),ae(R).isLoggedIn?(i(),v(f,{key:0,class:"text-none",color:"success","prepend-icon":"mdi-tag-plus",size:"small",variant:"outlined",onClick:fe},{default:s(()=>e[46]||(e[46]=[p(" 分類管理 ")])),_:1,__:[46]})):g("",!0)])]),$.value?(i(),v(Y,{key:1},{default:s(()=>[t(_,{class:"text-center",cols:"12"},{default:s(()=>[t(kt,{color:"success",indeterminate:"",size:"64"}),e[47]||(e[47]=n("p",{class:"mt-4 text-body-1"},"載入回憶中...",-1))]),_:1,__:[47]})]),_:1})):xe.value.length>0?(i(),v(Y,{key:2},{default:s(()=>[(i(!0),b(J,null,X(xe.value,a=>(i(),v(_,{key:a._id,cols:"12",lg:"4",md:"6",sm:"6"},{default:s(()=>[t(Ct,{diary:a,onClick:y=>je(a)},null,8,["diary","onClick"])]),_:2},1024))),128))]),_:1})):(i(),v(Y,{key:3},{default:s(()=>[t(_,{class:"text-center",cols:"12"},{default:s(()=>[t(C,{class:"mb-4",color:"grey-lighten-1",size:"64"},{default:s(()=>e[48]||(e[48]=[p("mdi-book-heart-outline")])),_:1,__:[48]}),e[50]||(e[50]=n("h3",{class:"text-h5 text-grey-darken-1 mb-2"},"還沒有回憶",-1)),e[51]||(e[51]=n("p",{class:"text-body-1 text-grey"},"開始記錄您的美好時刻吧！",-1)),ae(R).isLoggedIn?(i(),v(f,{key:0,class:"mt-4",color:"success",onClick:e[15]||(e[15]=a=>l.$router.push("/user/diary"))},{default:s(()=>e[49]||(e[49]=[p(" 新增回憶 ")])),_:1,__:[49]})):g("",!0)]),_:1,__:[50,51]})]),_:1})),be.value>1&&!$.value?(i(),b("div",Tt,[t(Dt,{modelValue:I.value,"onUpdate:modelValue":e[16]||(e[16]=a=>I.value=a),length:be.value,rounded:"circle","show-first-last-page":"","total-visible":7},null,8,["modelValue","length"])])):g("",!0),t(le,{modelValue:m.value.open,"onUpdate:modelValue":e[24]||(e[24]=a=>m.value.open=a),"max-width":"800"},{default:s(()=>[m.value.diary?(i(),v(O,{key:0},{default:s(()=>[t(se,{class:"d-flex align-center justify-space-between"},{default:s(()=>{var a;return[n("div",Et,[w.value?(i(),b("div",jt,[t(H,{modelValue:r.value.title,"onUpdate:modelValue":e[17]||(e[17]=y=>r.value.title=y),class:"title-input",density:"compact","hide-details":"",placeholder:"輸入標題",style:Me({width:Math.max(200,Math.min(400,(((a=r.value.title)==null?void 0:a.length)||0)*12+100))+"px",maxWidth:"400px",minWidth:"100px"}),variant:"outlined"},null,8,["modelValue","style"]),m.value.diary.date?(i(),v(ue,{key:0,class:"ml-2",color:"success",size:"small"},{default:s(()=>[p(A(ke(m.value.diary.date)),1)]),_:1})):g("",!0)])):(i(),b("div",Nt,[n("span",Ot,A(m.value.diary.title||"無標題"),1),m.value.diary.date?(i(),v(ue,{key:0,class:"ml-2",color:"success",size:"small"},{default:s(()=>[p(A(ke(m.value.diary.date)),1)]),_:1})):g("",!0)]))]),n("div",Wt,[!w.value&&Xe.value?(i(),v(f,{key:0,loading:te.value,disabled:te.value,icon:"mdi-pencil",size:"small",variant:"text",onClick:Qe},null,8,["loading","disabled"])):g("",!0),w.value?(i(),v(f,{key:1,disabled:K.value,icon:"mdi-check",size:"small",variant:"text",onClick:Ve},null,8,["disabled"])):g("",!0),w.value?(i(),v(f,{key:2,icon:"mdi-close",size:"small",variant:"text",onClick:we})):g("",!0),w.value?g("",!0):(i(),v(f,{key:3,icon:"mdi-close",variant:"text",onClick:We}))])]}),_:1}),t(oe,null,{default:s(()=>[w.value?g("",!0):(i(),b("div",Ht,[m.value.diary.image&&m.value.diary.image.length>0?(i(),v(_t,{key:0,class:"mb-4",height:"400","hide-delimiter-background":"","show-arrows":"hover"},{default:s(()=>[(i(!0),b(J,null,X(m.value.diary.image,(a,y)=>(i(),v(ht,{key:y},{default:s(()=>[t(Se,{class:"rounded",cover:"",height:"100%",src:a},null,8,["src"])]),_:2},1024))),128))]),_:1})):g("",!0)])),w.value?(i(),b("div",Qt,[t(re,{class:"text-body-2 font-weight-medium mb-2"},{default:s(()=>e[52]||(e[52]=[p("圖片管理")])),_:1,__:[52]}),r.value.existingImages&&r.value.existingImages.length>0?(i(),b("div",Yt,[e[53]||(e[53]=n("p",{class:"text-caption text-medium-emphasis mb-2"},"目前的圖片（點擊刪除鈕移除）",-1)),n("div",qt,[(i(!0),b(J,null,X(r.value.existingImages,(a,y)=>(i(),b("div",{key:y,class:"position-relative",style:{width:"120px",height:"120px"}},[t(Se,{class:"rounded",cover:"",height:"100%",src:a,width:"100%"},null,8,["src"]),t(f,{class:"position-absolute",color:"error",icon:"mdi-close",size:"x-small",style:{top:"4px",right:"4px"},variant:"flat",onClick:V=>He(y)},null,8,["onClick"])]))),128))])])):g("",!0),t(O,{class:"pa-4",variant:"outlined"},{default:s(()=>[n("div",Jt,[t(C,{class:"mr-2",color:"success",icon:"mdi-image"}),e[54]||(e[54]=n("span",{class:"text-subtitle-1 font-weight-medium"},"新增圖片",-1))]),t(o,{ref_key:"editFileAgent",ref:Ue,modelValue:q.value,"onUpdate:modelValue":e[18]||(e[18]=a=>q.value=a),"raw-model-value":G.value,"onUpdate:rawModelValue":e[19]||(e[19]=a=>G.value=a),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不正確",size:"檔案大小不得超過 1MB"},"help-text":"選擇或拖曳圖片檔案到此處","max-files":5,"max-size":"1MB",multiple:"",theme:"grid","url-resolver":a=>a.url?a.url:a.data?a.data:a.preview?a.preview:null},null,8,["modelValue","raw-model-value","url-resolver"])]),_:1})])):g("",!0),w.value?(i(),b("div",Xt,[t(re,{class:"text-body-2 font-weight-medium mb-2"},{default:s(()=>e[55]||(e[55]=[p("回憶日期")])),_:1,__:[55]}),t(H,{modelValue:r.value.date,"onUpdate:modelValue":e[20]||(e[20]=a=>r.value.date=a),density:"compact","hide-details":"",type:"datetime-local",variant:"outlined"},null,8,["modelValue"])])):g("",!0),w.value?(i(),b("div",Gt,[t(re,{class:"text-body-2 font-weight-medium mb-2"},{default:s(()=>e[56]||(e[56]=[p("分類")])),_:1,__:[56]}),t(pe,{modelValue:r.value.category,"onUpdate:modelValue":e[21]||(e[21]=a=>r.value.category=a),density:"compact","hide-details":"",items:me.value,variant:"outlined"},null,8,["modelValue","items"])])):g("",!0),n("div",Kt,[e[57]||(e[57]=n("h4",{class:"text-h6 mb-2"},"今日三件好事：",-1)),w.value?(i(),v(Pe,{key:0,modelValue:r.value.description,"onUpdate:modelValue":e[22]||(e[22]=a=>r.value.description=a),"hide-details":"",placeholder:"輸入您的回憶內容...",rows:"6",variant:"outlined"},null,8,["modelValue"])):(i(),b("p",Zt,A(m.value.diary.description),1))]),w.value?(i(),b("div",ea,[t(re,{class:"text-body-2 font-weight-medium mb-2"},{default:s(()=>e[58]||(e[58]=[p("顯示狀態")])),_:1,__:[58]}),t(ze,{modelValue:r.value.sell,"onUpdate:modelValue":e[23]||(e[23]=a=>r.value.sell=a),color:"success","hide-details":"",label:r.value.sell?"公開":"私人"},null,8,["modelValue","label"])])):g("",!0),t(L,{class:"my-4"}),n("div",ta," 建立於："+A(qe(m.value.diary.createdAt)),1)]),_:1}),w.value?(i(),v(ie,{key:0,class:"pa-6 pt-0"},{default:s(()=>[t(ne),t(f,{color:"grey-darken-1",variant:"outlined",onClick:we},{default:s(()=>e[59]||(e[59]=[p(" 取消 ")])),_:1,__:[59]}),t(f,{class:"ml-3",color:"success",loading:K.value,variant:"flat",onClick:Ve},{default:s(()=>e[60]||(e[60]=[p(" 保存變更 ")])),_:1,__:[60]},8,["loading"])]),_:1})):g("",!0)]),_:1})):g("",!0)]),_:1},8,["modelValue"])]),_:1})}}};typeof Ie=="function"&&Ie(aa);export{aa as default};
