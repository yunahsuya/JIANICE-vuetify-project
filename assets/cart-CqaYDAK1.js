import{P as B,u as I,a as L,r as N,Q as _,b as P,c as v,o as l,w as t,d as e,e as V,l as k,F as y,n as T,R as D,p as u,t as d,i as R,j as U,h as F,S as b}from"./index-8XkL9mke.js";import{o as $}from"./order-BQa2avIt.js";import{b as h}from"./route-block-B_A1xBdJ.js";import{V as j,a as i}from"./VRow-BxM1Nn8a.js";import{V as C}from"./VDivider-DhumEhaV.js";import{V as A,a as E,b as Q,c as z}from"./VList-BZs7Wlsb.js";import{V as G}from"./VNumberInput-Dm-6Fl9c.js";import{V as H}from"./VContainer-3X4AzbHd.js";import"./ssrBoot-H2_3cXLE.js";const J={__name:"cart",setup(K){const c=B(),p=I(),x=L(),s=N([]);(async()=>{try{const{data:r}=await b.getCart();s.value=r.result}catch(r){console.error(r),c({text:"無法獲取購物車資料",snackbarProps:{color:"red"}})}})();const g=async(r,o,n)=>{try{const{data:a}=await b.cart({product:o.product._id,quantity:r-o.quantity});o.quantity=r,r<=0&&s.value.splice(n,1),p.cartTotal=a.result}catch(a){console.error(a),c({text:"更新購物車失敗",snackbarProps:{color:"red"}})}},w=_(()=>s.value.reduce((r,o)=>r+o.product.price*o.quantity,0)),S=_(()=>s.value.length===0||s.value.some(r=>!r.product.sell)),q=async()=>{try{await $.create(),p.cartTotal=0,x.push("/orders")}catch{console.error(error),c({text:"結帳失敗",snackbarProps:{color:"red"}})}};return(r,o)=>{const n=P("router-link");return l(),v(H,null,{default:t(()=>[e(j,null,{default:t(()=>[e(i,{cols:"12"},{default:t(()=>o[0]||(o[0]=[V("h1",{class:"text-center"},"購物車",-1)])),_:1,__:[0]}),e(C),e(i,{cols:"12"},{default:t(()=>[e(A,{lines:"two"},{default:t(()=>[(l(!0),k(y,null,T(s.value,(a,m)=>(l(),k(y,{key:a._id},[e(E,{active:!a.product.sell,color:"red"},{prepend:t(()=>[e(R,{class:"cursor-pointer",rounded:"0",onClick:f=>r.$router.push("/product/"+a.product._id)},{default:t(()=>[e(U,{src:a.product.image},null,8,["src"])]),_:2},1032,["onClick"])]),append:t(()=>[e(G,{"control-variant":"split","hide-details":"",min:0,"model-value":a.quantity,variant:"outlined",width:"150px","onUpdate:modelValue":f=>g(f,a,m)},null,8,["model-value","onUpdate:modelValue"])]),default:t(()=>[e(Q,null,{default:t(()=>[e(n,{class:"text-decoration-none text-white",to:"/product/"+a.product._id},{default:t(()=>[u(d(a.product.name),1)]),_:2},1032,["to"])]),_:2},1024),e(z,null,{default:t(()=>[u(" 價格: "+d(a.product.price)+" 元 ",1)]),_:2},1024)]),_:2},1032,["active"]),m<s.value.length-1?(l(),v(C,{key:0})):D("",!0)],64))),128))]),_:1})]),_:1}),e(i,{class:"text-center",cols:"12"},{default:t(()=>[V("p",null,"總金額: "+d(w.value),1),e(F,{color:"primary",disabled:S.value,onClick:q},{default:t(()=>o[1]||(o[1]=[u("結帳")])),_:1,__:[1]},8,["disabled"])]),_:1})]),_:1})]),_:1})}}};typeof h=="function"&&h(J);export{J as default};
